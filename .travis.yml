sudo: false
language: android
jdk: oraclejdk8
before_cache:
- rm -f $HOME/.gradle/caches/modules-2/modules-2.lock
- rm -fr $HOME/.gradle/caches/*/plugin-resolution/
- r features/support
- r features/step_definitions
cache:
 directories:
 - $HOME/.gradle/caches
 - $HOME/.gradle/wrapper/
env:
 global:
  - ANDROID_API_LEVEL=25
  - EMULATOR_API_LEVEL=21
  - ANDROID_BUILD_TOOLS_VERSION=28.0.3
  - ANDROID_ABI=google_apis/armeabi-v7a
  - ADB_INSTALL_TIMEOUT=20
android:
 components:
  - platform-tools
  - tools
  - android-28
  - build-tools-28.0.3
  - extra-google-m2repository
  - extra-android-m2repository
  # Google Play Services
  - extra-google-google_play_services
  # Support library
  - extra-android-support
  - addon-google_apis-google-$ANDROID_API_LEVEL
  - addon-google_apis-google-$EMULATOR_API_LEVEL
  - sys-img-armeabi-v7a-addon-google_apis-google-$ANDROID_API_LEVEL
  - sys-img-armeabi-v7a-addon-google_apis-google-$EMULATOR_API_LEVEL
before_install:
- chmod +x gradlew
- yes | sdkmanager "platforms;android-28"

addons:
  sonarcloud:
    organization: "segismundo-github" # the key of the org you chose at step #3
    token:
      # encrypted value of your token
      secure: "FLz03hPdVi200gJlp7KRu5SaezIlZUj2QJIr1waXQu9IaHiyCFXaQd37E4Wtuii8hoA5ZYXxEieg09P8M43gbwQii0UmrlVbYl54D+JZf9s53j45sIzcJDkxj1zhDO6RFFfYdWvjAJnb9I6oYganjQDUCHefFTBPZgQFT6a9zqMA8G7AekS390lee3qsxvJOPrvJrpwQue0s/EX64SaJ5f+LpZZYVtpm9QxE2XpxdChIdNfZdNUx17Ck2JbZngLBEj2q8TgV5jd5zKa2XXZ/tfRhefBi3pP2ZiqiUguxDlpWrhpVpvZPiJUVIMUUDPx9hFrZUNZCyortwkytrQSD2EecXHE4LvGxJ/eud8ANm18AEF/Etso+OXGCh7bFeWeSGM0yL1CM4q9kRgS02mOye36jAQohZ28dS5YzM3Swiu21ObyHAlYkCmuF2HfdTC47WU7lr8JM/uS2TM6MIvrVGJnmjiFyF37IC/7/b3m5DQCbA7R99iBbBpEPLc8yNiTrzxE9YF+bajg00ksVOBs/DB1ASW9AayrdRDBB8szb/y2PGwp7evgZJnq5pVMrMpRx82QFop8AoL9H0jnphqJx4lnL2o+sfJeUvJ+aeiukmRboYp7qEzl+vL9QBFgDMlIdlH3gvyDru403E0QrBDV5yUBQAPCeRT26dAKkcVxn5vk="

script:
- ./gradlew clean
- ./gradlew assembleDebug
- ./gradlew assembleDebugAndroidTest
- sonar-scanner

deploy:
 provider: releases
 api_key: $GITHUB_TOKEN
 file: 
  - "app/*"
 skip_cleanup: true
 on:
  repo: Segismundo/Calidad-Software-Junio
  tags: false